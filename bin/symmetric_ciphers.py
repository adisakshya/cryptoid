"""
MODULE NAME: symmetric_ciphers
CONTENTS: -----------------------
Author: Adisakshya Chauhan
version: 1.1
"""

# import module container
from helper import *

# list of all supported ciphers
ciphers_block = ['', AES, DES, DES3, ARC2, CAST, Blowfish, ARC4]
ciphers_stream = ['', ARC4, Salsa20, ChaCha20]
# list of all supported modes of operation
#modes = ['',MODE_ECB,MODE_CBC,MODE_CFB,MODE_OFB,MODE_CTR,MODE_EAX]
modes = ['', 1, 2, 3, 5, 6, 9]

# function to create a new block cipher and return it's instance
def create_instance(x, key, mode_no, iv):
    
    try:    
        
        # cases for auto-generated byte key or user input string key
        # for modes other than ECB and CTR
        try:
            
            return ciphers[x].new(key.encode('utf-8'), modes[mode_no], iv.encode('utf-8'))
        
        except Exception:
            
            return ciphers[x].new(key, modes[mode_no], iv.encode('utf-8'))

    except Exception:
        
        # cases for auto-generated byte key or user input string key
        # for modes ECB and CTR
        try:

            return ciphers[x].new(key.encode('utf-8'), modes[mode_no])
        
        except Exception:
            
            return ciphers[x].new(key, modes[mode_no])

# function to create a new stream cipher and return it's instance
def create_instance_2(x, key):
    
    try:    
        
        # cases for auto-generated byte key or user input string key
        # for modes other than ECB and CTR
        try:
            
            return ciphers[x].new(key.encode('utf-8'))
        
        except Exception:
            
            return ciphers[x].new(key)

    except Exception:
        
        # cases for auto-generated byte key or user input string key
        # for modes ECB and CTR
        try:

            return ciphers[x].new(key.encode('utf-8'))
        
        except Exception:
            
            return ciphers[x].new(key)


# function to return cipher_text
def get_cipher_text(obj, message):

    try:

        return obj.encrypt(message.encode('utf-8'))

    except Exception as error:

        print('Caught this error in making cipher_text: ' + repr(error))

# function to return original message
def get_original_message(obj, cipher_text):

    try:

        return obj.decrypt(cipher_text)

    except Exception as error:

        print('Caught this error in getting original message back: ' + repr(error))    

# function to do padding of -----space----- on message
def padding(message, block_size):
    
    if len(message)%block_size == 0:
        return message
    else:
        padding_factor = (len(message)//block_size + 1)*block_size - len(message)  

    return (message + " "*padding_factor)


# BLOCK CIPHERS
"""
Advance Encryption Standard (AES)
MODES:
    1. ECB
    2. CBC
    3. CFB
    4. OFB
    5. CTR
    6. EAX
BLOCK_SIZE: 16
KEY_SIZE = (16, 24, 32)
"""
class aes(object):

    # functtion to generate key of length - (size) bytes
    def generate_key(size):

        # return generated key as byte object
        return AES.get_random_bytes(size)

    # function to return ciphertext
    def encrypt(message, key, mode_no=1, iv='This is an IV456'):

        try:
            
            # create new AES cipher
            obj = create_instance(1, key, mode_no, iv)
            
            # padding
            message = padding(message,16)

            # get cipher_text
            cipher_text = get_cipher_text(obj, message)
            #cipher_text = str(cipher_text, 'utf-8')

            # return cipher_text
            return cipher_text                         
        
        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

    # function to decrypt ciphertext
    def decrypt(cipher_text, key, mode_no=1, iv='This is an IV456'):
        
        try:
            
            # create new AES cipher
            obj = create_instance(1, key, mode_no, iv)
            
            # return original message
            message =  get_original_message(obj,cipher_text)

            # remove padding
            message = str(message, 'utf-8')
            message = message.strip(' ')

            # return original message
            return message

        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))


"""
Data Encryption Standard (DES)
MODES:
    1. ECB
    2. CBC
    3. CFB
    4. OFB
    5. CTR
    6. EAX
BLOCK_SIZE: 8
KEY_SIZE = 8
"""
class des(object):

    # function to return ciphertext
    def encrypt(message, key, mode_no=1, iv='This is an IV456'):

        try:
            
            # create new AES cipher
            obj = create_instance(2, key, mode_no, iv)
            
            # padding
            message = padding(message,8)

            # get cipher_text
            cipher_text = get_cipher_text(obj, message)
            #cipher_text = str(cipher_text, 'utf-8')

            # return cipher_text
            return cipher_text                         
        
        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

    # function to decrypt ciphertext
    def decrypt(cipher_text, key, mode_no=1, iv='This is an IV456'):
        
        try:
            
            # create new AES cipher
            obj = create_instance(2, key, mode_no, iv)
            
            # return original message
            message =  get_original_message(obj,cipher_text)

            # remove padding
            message = str(message, 'utf-8')
            message = message.strip(' ')

            # return original message
            return message

        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))


"""
Triple Data Encryption Standard (DES3)
MODES:
    1. ECB
    2. CBC
    3. CFB
    4. OFB
    5. CTR
    6. EAX
BLOCK_SIZE: 8
KEY_SIZE = (16, 24) ------ 8*3 == 24 -----------
"""
class triple_des(object):

    # function to return ciphertext
    def encrypt(message, key, mode_no=1, iv='This is an IV456'):

        try:
            
            # create new AES cipher
            obj = create_instance(2, key, mode_no, iv)
            
            # padding
            message = padding(message,8)

            # get cipher_text
            cipher_text = get_cipher_text(obj, message)
            #cipher_text = str(cipher_text, 'utf-8')

            # return cipher_text
            return cipher_text                         
        
        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

    # function to decrypt ciphertext
    def decrypt(cipher_text, key, mode_no=1, iv='This is an IV456'):
        
        try:
            
            # create new AES cipher
            obj = create_instance(2, key, mode_no, iv)
            
            # return original message
            message =  get_original_message(obj,cipher_text)

            # remove padding
            message = str(message, 'utf-8')
            message = message.strip(' ')

            # return original message
            return message

        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))


"""
Rivest's Cipher version 2 (RC2)
MODES:
    1. ECB
    2. CBC
    3. CFB
    4. OFB
    5. CTR
    6. EAX
BLOCK_SIZE: 8
KEY_SIZE: (5, 129)    
"""
class rc2(object):

    # function to return ciphertext
    def encrypt(message, key, mode_no=1, iv='This is an IV456'):

        try:
            
            # create new AES cipher
            obj = create_instance(4, key, mode_no, iv)
            
            # padding
            message = padding(message,16)

            # get cipher_text
            cipher_text = get_cipher_text(obj, message)
            #cipher_text = str(cipher_text, 'utf-8')

            # return cipher_text
            return cipher_text                         
        
        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

    # function to decrypt ciphertext
    def decrypt(cipher_text, key, mode_no=1, iv='This is an IV456'):
        
        try:
            
            # create new AES cipher
            obj = create_instance(4, key, mode_no, iv)
            
            # return original message
            message =  get_original_message(obj,cipher_text)

            # remove padding
            message = str(message, 'utf-8')
            message = message.strip(' ')

            # return original message
            return message

        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

"""
CAST
MODES:
    1. ECB
    2. CBC
    3. CFB
    4. OFB
    5. CTR
    6. EAX
BLOCK_SIZE: 8
KEY_SIZE = (5, 17)
"""
class cast(object):

    # function to return ciphertext
    def encrypt(message, key, mode_no=1, iv='This is an IV456'):

        try:
            
            # create new AES cipher
            obj = create_instance(5, key, mode_no, iv)
            
            # padding
            message = padding(message,8)

            # get cipher_text
            cipher_text = get_cipher_text(obj, message)
            #cipher_text = str(cipher_text, 'utf-8')

            # return cipher_text
            return cipher_text                         
        
        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

    # function to decrypt ciphertext
    def decrypt(cipher_text, key, mode_no=1, iv='This is an IV456'):
        
        try:
            
            # create new AES cipher
            obj = create_instance(5, key, mode_no, iv)
            
            # return original message
            message =  get_original_message(obj,cipher_text)

            # remove padding
            message = str(message, 'utf-8')
            message = message.strip(' ')

            # return original message
            return message

        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))


"""
Blowfish
MODES:
    1. ECB
    2. CBC
    3. CFB
    4. OFB
    5. CTR
    6. EAX
BLOCK_SIZE: 8
KEY_SIZE = (5, 57)
"""
class cast(object):

    # function to return ciphertext
    def encrypt(message, key, mode_no=1, iv='This is an IV456'):

        try:
            
            # create new AES cipher
            obj = create_instance(6, key, mode_no, iv)
            
            # padding
            message = padding(message,8)

            # get cipher_text
            cipher_text = get_cipher_text(obj, message)
            #cipher_text = str(cipher_text, 'utf-8')

            # return cipher_text
            return cipher_text                         
        
        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

    # function to decrypt ciphertext
    def decrypt(cipher_text, key, mode_no=1, iv='This is an IV456'):
        
        try:
            
            # create new AES cipher
            obj = create_instance(6, key, mode_no, iv)
            
            # return original message
            message =  get_original_message(obj,cipher_text)

            # remove padding
            message = str(message, 'utf-8')
            message = message.strip(' ')

            # return original message
            return message

        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))


# STREAM CIPHERS
"""
ARC4
BLOCK_SIZE: 1
KEY_SIZE = (16, 32)
"""
class rc4(object):

    # function to return ciphertext
    def encrypt(message, key):

        try:
            
            # create new AES cipher
            obj = create_instance_2(7, key)
            
            # padding
            message = padding(message,1)

            # get cipher_text
            cipher_text = get_cipher_text(obj, message)
            #cipher_text = str(cipher_text, 'utf-8')

            # return cipher_text
            return cipher_text                         
        
        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

    # function to decrypt ciphertext
    def decrypt(cipher_text, key):
        
        try:
            
            # create new AES cipher
            obj = create_instance_2(7, key)
            
            # return original message
            message =  get_original_message(obj,cipher_text)

            # remove padding
            message = str(message, 'utf-8')
            message = message.strip(' ')

            # return original message
            return message

        except Exception as error:
            
            # report error
            print('Caught this error: ' + repr(error))

"""
Salsa20
BLOCK_SIZE = 1
KEY_SIZE = 32
"""
class salsa20(object):

    def generate_key(size):

        return Salsa20.get_random_bytes(size)

    # function to return ciphertext
    def encrypt(message, secret):
        
        cipher = Salsa20.new(key = secret)
        msg = cipher.nonce + cipher.encrypt(message.encode('utf-8'))
        return msg

    # function to decrypt ciphertext
    def decrypt(msg, secret):        
        
        msg_nonce = msg[:8]
        cipher_text = msg[8:]
        cipher = Salsa20.new(key=secret, nonce=msg_nonce)
        message = cipher.decrypt(cipher_text)
        return message

"""
ChaCha20
BLOCK_SIZE = 1
KEY_SIZE = 32
"""
class chacha20(object):

    def generate_key(size):

        return ChaCha20.get_random_bytes(size)

    # function to return ciphertext
    def encrypt(message, secret):
        
        cipher = ChaCha20.new(key = secret)
        msg = cipher.nonce + cipher.encrypt(message.encode('utf-8'))
        return msg

    # function to decrypt ciphertext
    def decrypt(msg, secret):        
        
        msg_nonce = msg[:8]
        cipher_text = msg[8:]
        cipher = ChaCha20.new(key=secret, nonce=msg_nonce)
        message = cipher.decrypt(cipher_text)
        return message        